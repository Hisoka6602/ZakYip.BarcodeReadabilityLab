# 训练超参数推荐配置

本文档提供在 ZakYip Barcode Readability Lab 中训练图像分类模型时的超参数推荐配置和调优建议。所有参数都可以通过 HTTP 接口请求体或 `TrainingOptions` 配置节进行设置。

## 默认值概览

| 参数 | 默认值 | 说明 |
| ---- | ------ | ---- |
| LearningRate | 0.01 | 使用 ResNet50 特征抽取器进行迁移学习时的稳定学习率。 |
| Epochs | 50 | 能够在中等规模数据集上收敛，同时避免过拟合。 |
| BatchSize | 20 | 在 8GB 内存环境下仍然能保持稳定训练。 |
| ValidationSplitRatio | 0.2 | 80% 数据用于训练，20% 用于验证。 |

## 推荐区间

| 参数 | 推荐区间 | 适用场景 |
| ---- | -------- | -------- |
| LearningRate | 0.005 – 0.05 | 数据集样本量 1000 – 20000，硬件为单卡 CPU/GPU。 |
| Epochs | 30 – 120 | 样本量较小时降低 Epoch 以避免过拟合；样本量较大时提高 Epoch 获得更高精度。 |
| BatchSize | 16 – 64 | 根据内存/显存大小调整，数值越大训练越快但占用更多内存。 |

> ⚠️ **注意**：当前训练实现基于 CPU，Batch Size 设置过大可能导致内存不足。建议逐步提升并观察日志中的内存使用情况。

## 调优指南

1. **学习率 (LearningRate)**
   - 如果训练日志显示损失震荡或准确率长期停滞，请尝试将学习率降低到 0.005。
   - 如果训练速度过慢且准确率提升平缓，可尝试提升至 0.02 – 0.03，但不要超过 0.05。
2. **Epochs**
   - 在新增数据后，建议先使用较小 Epoch（如 30）快速验证；确认模型趋势后再提高。
   - 训练完成后可通过验证集准确率判断是否需要增加 Epoch。
3. **Batch Size**
   - 观察服务日志中的“训练中”条目，如果出现内存压力，可将 Batch Size 调整为 16 或 12。
   - 若硬件资源充足，可逐步增大 Batch Size 以提升吞吐量。
4. **验证集比例**
   - 小型数据集（< 2000 张）建议将验证集比例调整为 0.25，以保证验证样本数量。
   - 大型数据集可维持 0.2 或降低至 0.1，提高训练样本数量。

## 示例配置

```json
{
  "trainingRootDirectory": "C:\\BarcodeImages\\TrainingData",
  "outputModelDirectory": "C:\\BarcodeImages\\Models",
  "validationSplitRatio": 0.2,
  "learningRate": 0.015,
  "epochs": 80,
  "batchSize": 32,
  "remarks": "第二版模型调优"
}
```

## 更多建议

- 在修改超参数后，建议记录训练日志和评估指标，以便进行 A/B 对比。
- 若需要自动化调参，可在后续迭代中引入网格搜索或贝叶斯优化。
- 如需 GPU 加速，可考虑将训练组件迁移至支持 GPU 的运行环境，并适当增大 Batch Size。
